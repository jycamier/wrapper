# Wrapper - A profile Manager for Any Binary

Wrapper is a transparent configuration profile manager for any CLI binary. It allows you to manage multiple environment configurations (profiles) and seamlessly switch between them.

<img src="docs/img/img.png" alt="small" width="300"/>

## Features

- 🔧 **Universal**: Works with any binary (vault, aws, kubectl, etc.)
- 📁 **Profile Management**: Create, list, and switch between profiles
- 🔄 **Transparent Execution**: Acts as a pass-through wrapper
- 💾 **Simple Storage**: Profiles stored as `.env` files
- 🎯 **Smart Resolution**: Automatically finds the real binary in PATH

## Configuration Structure

Wrapper stores all profiles in `~/.config/wrapper/`:

```
$HOME/.config/wrapper/
├── aliases.bash
├── aliases.fish
├── aliases.zsh
├── gcloud
│   ├── current.env -> $HOME/.config/wrapper/gcloud/prod.env
│   ├── dev.env
│   ├── preprod.env
│   └── prod.env
└── vault
    ├── current.env -> $HOME/.config/wrapper/vault/prod.env
    ├── dev.env
    ├── prod.env
    └── test.env
```

- **`aliases.*`** - Shell-specific alias files
- **`<binary>/`** - Directory for each wrapped binary
- **`<binary>/*.env`** - Profile files (KEY=VALUE format)
- **`<binary>/current.env`** - Symlink to the active profile

## Installation

```bash
go install github.com/jycamier/wrapper@latest
```

## Quick Start

### 1. Create a profile

Imagine you have a staging and production instances of Vault. You can create a profile for each instance.

```bash
wrapper vault profile create staging
```
This command creates `~/.config/wrapper/vault/staging.env`. Then you can edit it to configure the environment variable 
you need for your profile.

```env
VAULT_ADDR=https://vault.example.com
VAULT_NAMESPACE=admin
```

### 2. Set the profile

You need to set the profile to use for the current session.

```bash
wrapper vault profile set staging
wrapper vault status ## 
```

Then you can calls `vault status` command with staging environment loaded: 

```bash
wrapper vault status
```

### 3. Generate aliases

```bash
wrapper alias
```

This creates alias command files in `~/.config/wrapper/` for bash, zsh, and fish. These commands wrap the initial command
with the profile you set.

Here's an example of the alias.bash file:
```
# Wrapper aliases for Bash
# Generated by wrapper - DO NOT EDIT MANUALLY
# Regenerate with: wrapper alias

vault() { wrapper vault "$@"; }
```


### 5. Set the profile

```bash
vault profile set prod
```

### 6. Use it!

```bash
vault status
# Executes /usr/bin/vault status with prod environment
```

## Usage

### Wrapper Commands

```bash
# List all configured binaries
wrapper list

# Generate shell alias files
wrapper alias
```

### Profile Commands

```bash
# List profiles (with colors and current highlighted)
wrapper <binary> profile

# Create a new profile
wrapper <binary> profile create <name>

# Set current profile
wrapper <binary> profile set <name>
```

### Execute with Profile

Any command that is NOT `profile` will execute the real binary with the active profile's environment:

```bash
vault login
aws s3 ls
kubectl get pods
```

## How It Works

1. **Wrapper Detection**: Determines the binary name from how it was invoked
2. **Command Routing**:
   - If command is `profile` → manage profiles
   - Otherwise → execute real binary
3. **Profile Loading**: Loads environment from `current.env` (or default profile)
4. **Binary Execution**: Finds real binary in PATH and executes with loaded environment

## Architecture

Wrapper follows **Domain-Driven Design (DDD)** with clean architecture:

- **Domain Layer**: Core business logic (Profile, Repository interfaces)
- **Application Layer**: Use cases (ProfileService, ExecutorService)
- **Infrastructure Layer**: Filesystem storage, binary resolution
- **Presentation Layer**: CLI commands

## License

See [LICENSE](./LICENSE) file.
